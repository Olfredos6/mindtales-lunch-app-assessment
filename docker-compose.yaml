version: "3.9"

services:  
  reverser:
      image: nginx
      volumes:
        - "./services/reverser/confs:/etc/nginx/conf.d"
      ports:
        - "80:80"      


  postgres:
    image: postgres:latest
    restart: unless-stopped
    env_file: ./services/postgres/.env
    volumes:
      - "./services/postgres/data:/var/lib/postgresql/data"
    
  auth:
    build: ./services/auth
    depends_on:
      - postgres
      - reverser
    volumes:
      - "./services/auth/src:/auth-app"
    expose:
      - "3000"
    # Do not forget adding "python manage.py makemigrations && python manage.py migrate"
    command: bash -c "./wait-for-it.sh postgres:5432 -t 60 --strict -- gunicorn --bind :3000 --workers 3 --reload auth.wsgi:application"

  
  # api:



